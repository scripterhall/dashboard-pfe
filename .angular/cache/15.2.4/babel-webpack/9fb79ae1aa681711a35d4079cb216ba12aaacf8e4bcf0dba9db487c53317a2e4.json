{"ast":null,"code":"import { __read, __values } from \"tslib\";\nimport { ChartDataSets, Chart } from 'chart.js';\nimport { forkJoin } from 'rxjs';\nimport { RoleService } from 'src/app/service/role.service';\nimport { TicketTacheService } from 'src/app/service/ticket-tache.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/service/role.service\";\nimport * as i2 from \"src/app/service/ticket-tache.service\";\nvar HistoireMembreChartComponent = /** @class */function () {\n  function HistoireMembreChartComponent(roleService, ticketTacheService) {\n    this.roleService = roleService;\n    this.ticketTacheService = ticketTacheService;\n    this.bubbleChartData = [];\n    this.colors = ['rgba(255, 99, 132, 0.8)', 'rgba(54, 162, 235, 0.8)', 'rgba(255, 206, 86, 0.8)', 'rgba(75, 192, 192, 0.8)', 'rgba(153, 102, 255, 0.8)', 'rgba(255, 159, 64, 0.8)'];\n    this.bubbleChartLegend = true;\n    this.bubbleChartPlugins = [];\n  }\n  HistoireMembreChartComponent.prototype.generateColors = function (numColors) {\n    var colors = [];\n    for (var i = 0; i < numColors; i++) {\n      var color = \"#\" + ((1 << 24) * Math.random() | 0).toString(16);\n      colors.push(color);\n    }\n    this.colors = colors;\n  };\n  HistoireMembreChartComponent.prototype.ngOnInit = function () {\n    var _this = this;\n    var idProjet = JSON.parse(localStorage.getItem('projet')).id;\n    var ticketsObservable = this.ticketTacheService.getTicketsTacheBySprint(this.sprintId);\n    var roleObservable = this.roleService.afficherListRoleParProjet(idProjet);\n    // Utilisation de forkJoin pour attendre la récupération de toutes les données\n    forkJoin([roleObservable, ticketsObservable]).subscribe(function (_a) {\n      var e_1, _b;\n      var _c = __read(_a, 2),\n        roles = _c[0],\n        tickets = _c[1];\n      //recuoerer les membre par role\n      var membres = [];\n      _this.generateColors(roles.length);\n      try {\n        for (var roles_1 = __values(roles), roles_1_1 = roles_1.next(); !roles_1_1.done; roles_1_1 = roles_1.next()) {\n          var role = roles_1_1.value;\n          membres.push(role.membre);\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (roles_1_1 && !roles_1_1.done && (_b = roles_1.return)) _b.call(roles_1);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n      console.log(membres);\n      var bubbleChartData = [];\n      //ajouté dans le graphe \n      var membersAdded = [];\n      var historiesAdded = new Set();\n      for (var i = 0; i < membres.length; i++) {\n        var memberData = {\n          data: [],\n          label: membres[i].email,\n          backgroundColor: _this.colors[i],\n          borderColor: _this.colors[i]\n        };\n        for (var j = 0; j < tickets.length; j++) {\n          var tache = historiesAdded[j];\n          if (tache && tache.membreId === membres[i].id) {\n            var historyIndex = historiesAdded.indexOf(tache.ht);\n            if (historyIndex === -1) {\n              historiesAdded.push(tache.ht.id);\n              memberData.data.push({\n                x: i,\n                y: tache.ht.id,\n                r: 10\n              });\n            } else {\n              // Histoire de ticket déjà présente, on ignore cette histoire de ticket et on passe à l'itération suivante\n              continue;\n            }\n            if (membersAdded.indexOf(membres[i].id) === -1) {\n              // Membre non présent, on l'ajoute au tableau des membres\n              membersAdded.push(membres[i].id);\n            }\n          }\n        }\n        bubbleChartData.push(memberData);\n        console.log(bubbleChartData);\n      }\n      //conf\n      var chartOptions = {\n        scales: {\n          yAxes: [{\n            scaleLabel: {\n              display: true,\n              labelString: 'Histoire de ticket'\n            },\n            ticks: {\n              min: 0,\n              max: tickets.length,\n              autoSkip: true,\n              beginAtZero: true,\n              stepsSize: 1,\n              callback: function (value, index, values) {\n                var _a;\n                return (_a = tickets[index]) === null || _a === void 0 ? void 0 : _a.ht.titre;\n              }\n            },\n            gridLines: {\n              display: true,\n              drawBorder: true,\n              color: 'rgba(200, 200, 200, 0.2)',\n              drawOnChartArea: true,\n              drawTicks: true\n            }\n          }],\n          xAxes: [{\n            scaleLabel: {\n              display: true,\n              labelString: 'Membre'\n            },\n            ticks: {\n              stepSize: 1,\n              beginAtZero: false,\n              min: 0,\n              callback: function (value, index, values) {\n                var _a;\n                return (_a = membres[index]) === null || _a === void 0 ? void 0 : _a.email;\n              }\n            },\n            gridLines: {\n              display: true,\n              drawBorder: true,\n              color: 'rgba(200, 200, 200, 0.2)',\n              drawOnChartArea: true,\n              drawTicks: true\n            }\n          }]\n        },\n        tooltips: {\n          callbacks: {\n            label: function (tooltipItem, data) {\n              var datasetLabel = data.datasets[tooltipItem.datasetIndex].label;\n              var value = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];\n              console.log(value);\n              var memberName = membres[value.x].email;\n              var ticketTitle = value.y;\n              return \"\".concat(memberName, \": \").concat(ticketTitle);\n            }\n          }\n        },\n        elements: {\n          point: {\n            radius: 10,\n            hoverRadius: 15,\n            pointStyle: 'image',\n            pointRadius: 30,\n            pointHoverRadius: 35,\n            pointBorderWidth: 0,\n            pointHitRadius: 50,\n            pointBackgroundColor: 'url(../../../assets/icon.png)'\n          }\n        }\n      };\n      //creation \n      _this.canvas = document.getElementById(\"bubble-chart\");\n      _this.ctx = _this.canvas.getContext(\"2d\");\n      var chart = new Chart(_this.ctx, {\n        type: 'bubble',\n        data: {\n          datasets: bubbleChartData\n        },\n        options: chartOptions\n      });\n    });\n  };\n  HistoireMembreChartComponent.ɵfac = function HistoireMembreChartComponent_Factory(t) {\n    return new (t || HistoireMembreChartComponent)(i0.ɵɵdirectiveInject(i1.RoleService), i0.ɵɵdirectiveInject(i2.TicketTacheService));\n  };\n  HistoireMembreChartComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: HistoireMembreChartComponent,\n    selectors: [[\"app-histoire-membre-chart\"]],\n    inputs: {\n      sprintId: \"sprintId\"\n    },\n    decls: 2,\n    vars: 0,\n    consts: [[1, \"chart-area\"], [\"id\", \"bubble-chart\"]],\n    template: function HistoireMembreChartComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelement(1, \"canvas\", 1);\n        i0.ɵɵelementEnd();\n      }\n    }\n  });\n  return HistoireMembreChartComponent;\n}();\nexport { HistoireMembreChartComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import Chart from 'chart.js';\nimport { HistoireTicketService } from 'src/app/service/histoire-ticket.service';\nimport { ProductBacklogService } from 'src/app/service/product-backlog.service';\nimport { SprintService } from 'src/app/service/sprint.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/service/sprint.service\";\nimport * as i2 from \"src/app/service/product-backlog.service\";\nimport * as i3 from \"src/app/service/histoire-ticket.service\";\nvar CourbesComponent = /** @class */function () {\n  function CourbesComponent(sprintService, productBacklogService, histoireTicketService) {\n    this.sprintService = sprintService;\n    this.productBacklogService = productBacklogService;\n    this.histoireTicketService = histoireTicketService;\n    this.sprints = [];\n    this.ticketHistoireList = [];\n  }\n  CourbesComponent.prototype.ngOnInit = function () {\n    var _this = this;\n    var productBacklogId = 1; // remplacez par l'id du product backlog\n    this.sprintService.getListSprintsByProductBacklog(productBacklogId).subscribe(function (sprints) {\n      _this.sprints = sprints;\n      _this.drawBurnDownChart();\n    }, function (error) {\n      console.log(error);\n    });\n  };\n  CourbesComponent.prototype.drawBurnDownChart = function () {\n    var _this = this;\n    var sprint = this.sprints[0]; // utilisez le sprint que vous voulez afficher\n    this.histoireTicketService.getHistoireTicketBySprintId(sprint.id).subscribe(function (ticketHistoireList) {\n      _this.ticketHistoireList = ticketHistoireList;\n      var dates = _this.getDates(sprint.dateLancement, sprint.dateFin);\n      var effortEstime = _this.getEffortEstime(sprint);\n      var effortReel = _this.getEffortReel(sprint);\n      var data = {\n        labels: dates,\n        datasets: [{\n          label: 'Effort estimé',\n          data: effortEstime,\n          borderColor: 'blue',\n          fill: false\n        }, {\n          label: 'Effort réel',\n          data: effortReel,\n          borderColor: 'red',\n          fill: false\n        }]\n      };\n      var config = {\n        type: 'line',\n        data: data,\n        options: {\n          scales: {\n            x: {\n              display: true,\n              title: {\n                display: true,\n                text: 'Jour'\n              }\n            },\n            y: {\n              display: true,\n              title: {\n                display: true,\n                text: 'Effort'\n              }\n            }\n          }\n        }\n      };\n      new Chart('myChart', config);\n    });\n  };\n  // retourne un tableau avec l'effort estimé pour chaque jour du sprint\n  CourbesComponent.prototype.getEffortEstime = function (sprint) {\n    var effortEstime = [];\n    var currentDate = new Date(sprint.dateLancement);\n    var effortTotal = sprint.velocite;\n    while (currentDate <= sprint.dateFin) {\n      effortEstime.push(effortTotal);\n      currentDate.setDate(currentDate.getDate() + 1);\n      if (currentDate.getDay() === 1) {\n        // lundi, nouvelle semaine\n        effortTotal -= sprint.velocite * 0.1; // réduction de 10% chaque nouvelle semaine\n      }\n    }\n\n    return effortEstime;\n  };\n  // retourne un tableau avec l'effort réel pour chaque jour du sprint\n  CourbesComponent.prototype.getEffortReel = function (sprint, tickets) {\n    var dates = this.getDates(sprint.dateLancement, sprint.dateFin);\n    var effortReel = new Array(dates.length).fill(0);\n    tickets.forEach(function (ticket) {\n      var dateFinTicket = new Date(ticket.dateFin);\n      if (dateFinTicket > sprint.dateFin) {\n        dateFinTicket = sprint.dateFin;\n      }\n      var indexStart = dates.findIndex(function (date) {\n        return date >= ticket.dateDebut;\n      });\n      var indexEnd = dates.findIndex(function (date) {\n        return date >= dateFinTicket;\n      });\n      if (indexStart === -1) {\n        indexStart = 0;\n      }\n      if (indexEnd === -1) {\n        indexEnd = dates.length - 1;\n      }\n      for (var i = indexStart; i <= indexEnd; i++) {\n        effortReel[i] += ticket.effort || 0;\n      }\n    });\n    return effortReel;\n  };\n  CourbesComponent.ɵfac = function CourbesComponent_Factory(t) {\n    return new (t || CourbesComponent)(i0.ɵɵdirectiveInject(i1.SprintService), i0.ɵɵdirectiveInject(i2.ProductBacklogService), i0.ɵɵdirectiveInject(i3.HistoireTicketService));\n  };\n  CourbesComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CourbesComponent,\n    selectors: [[\"app-courbes\"]],\n    decls: 0,\n    vars: 0,\n    template: function CourbesComponent_Template(rf, ctx) {}\n  });\n  return CourbesComponent;\n}();\nexport { CourbesComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
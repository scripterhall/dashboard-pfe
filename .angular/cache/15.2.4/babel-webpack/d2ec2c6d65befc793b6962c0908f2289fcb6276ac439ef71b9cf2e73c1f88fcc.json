{"ast":null,"code":"import { __decorate, __metadata, __param } from \"tslib\";\nimport { Component, ElementRef, Inject, ViewChild } from '@angular/core';\nimport { FormBuilder, Validators } from '@angular/forms';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { SprintBacklog } from 'src/app/model/sprint-backlog';\nimport { HistoireTicketService } from 'src/app/service/histoire-ticket.service';\nimport { SprintBacklogService } from 'src/app/service/sprint-backlog.service';\nimport { SprintService } from 'src/app/service/sprint.service';\nimport { TicketTacheService } from 'src/app/service/ticket-tache.service';\nimport Swal from 'sweetalert2';\nvar SprintDialogPanelComponent = /** @class */function () {\n  function SprintDialogPanelComponent(dialogRef, data, fb, sprintService, ticketTacheService, histoireTicketService, sprintBacklogService) {\n    this.dialogRef = dialogRef;\n    this.data = data;\n    this.fb = fb;\n    this.sprintService = sprintService;\n    this.ticketTacheService = ticketTacheService;\n    this.histoireTicketService = histoireTicketService;\n    this.sprintBacklogService = sprintBacklogService;\n    this.ajouterTick = false;\n    this.isOpen = false;\n    this.modifActif = false;\n    this.listEtat = [\"terminer\", \"a faire\", \"a verifier\", \"en cours\"];\n  }\n  SprintDialogPanelComponent.prototype.ngOnInit = function () {\n    var _this = this;\n    console.log(this.data.sprint);\n    this.projet = JSON.parse(localStorage.getItem(\"projets\"));\n    this.TicketTacheModif = this.fb.group({\n      id: ['', Validators.required],\n      nbrHeurs: ['', Validators.required],\n      membreId: [],\n      SprintBacklogId: [],\n      etat: []\n    });\n    this.ticketTacheForm = this.fb.group({\n      nbHeurs: [null, Validators.required],\n      titre: ['', Validators.required],\n      description: [null, Validators.required]\n    });\n    var conv_data = new Date(this.data.sprint.dateLancement);\n    console.log(this.data.canStart);\n    if (conv_data.getDay() == new Date().getDay() && this.data.sprint.etat != \"en cours\" && this.data.canStart && this.data.TicketHistoires.length > 0) {\n      Swal.fire({\n        title: \"en appuyant sur le boutton <ok> votre sprint sera lancé avec la date \" + this.data.sprint.dateLancement.toDateString(),\n        icon: 'warning',\n        showCancelButton: true,\n        confirmButtonColor: '#3085d6',\n        cancelButtonColor: '#d33',\n        confirmButtonText: 'Oui, Lancer!',\n        cancelButtonText: 'Annuler',\n        background: 'rgba(0,0,0,0.9)',\n        backdrop: 'rgba(0,0,0,0.4)',\n        allowOutsideClick: false,\n        allowEscapeKey: false,\n        allowEnterKey: false,\n        focusConfirm: false\n      }).then(function (result) {\n        if (result.isConfirmed) {\n          // Le code à exécuter si l'utilisateur a cliqué sur \"Oui, supprimer!\"\n          _this.lancerSprint();\n          Swal.fire('succes de Lancement', 'Votre fichier a été supprimé.', 'success');\n        }\n      });\n    }\n  };\n  //afficher tous les ticket tâche d'un ticket histoire\n  SprintDialogPanelComponent.prototype.afficherTicketTache = function (ht) {\n    var _this = this;\n    this.ticketTacheService.getListTicketTacheParHt(ht.id).subscribe(function (data) {\n      console.log(data);\n      _this.ticketTacheList = data;\n    });\n  };\n  SprintDialogPanelComponent.prototype.showDetailSprint = function () {\n    this.isOpen = !this.isOpen;\n  };\n  //detacher ticket histoire de sprint\n  SprintDialogPanelComponent.prototype.detacherHt = function (ht, i) {\n    var _this = this;\n    console.log(ht.sprint);\n    if (confirm('vous êtes sur de detacher cette ticket histoire de sprint')) {\n      ht.sprintId = null;\n      this.histoireTicketService.DetacherHtSprint(ht).subscribe(function (dataHt) {\n        _this.data.TicketHistoires.splice(i, 1);\n      });\n    }\n  };\n  SprintDialogPanelComponent.prototype.showModif = function () {\n    // console.log(this.data.sprint.productBacklogId)\n    this.changeDates = this.fb.group({\n      dateLancement: [this.data.sprint.dateLancement, Validators.required],\n      dateFin: [this.data.sprint.dateFin, [this.validateDateFin.bind(this), Validators.required]]\n    });\n    this.modifActif = !this.modifActif;\n  };\n  //valider date fin\n  SprintDialogPanelComponent.prototype.validateDateFin = function (control) {\n    var _a;\n    var dateLancement = new Date((_a = control.parent) === null || _a === void 0 ? void 0 : _a.get('dateLancement').value);\n    var dateFin = new Date(control.value);\n    if (dateLancement && dateFin && dateLancement >= dateFin) {\n      return {\n        'dateFinInvalide': true\n      };\n    }\n    return null;\n  };\n  //modifier sprint detail\n  SprintDialogPanelComponent.prototype.terminerChangement = function () {\n    var _this = this;\n    console.log(this.data.sprint.productBacklogId);\n    this.data.sprint.productBacklogId = this.data.sprint.productBacklog.id;\n    this.data.sprint.etat = 'en attente';\n    this.data.sprint.dateLancement = this.changeDates.get('dateLancement').value;\n    this.data.sprint.dateFin = this.changeDates.get('dateFin').value;\n    this.sprintService.modifierSprint(this.data.sprint).subscribe(function (data) {\n      console.log(data);\n      _this.data.sprint = data;\n      _this.modifActif = false;\n    });\n  };\n  //afficher le formualire d'ajout\n  SprintDialogPanelComponent.prototype.showFormAjout = function () {\n    this.ajouterTick = !this.ajouterTick;\n  };\n  //ajouter une ticket tache dans le panel de detail sprint\n  SprintDialogPanelComponent.prototype.ajouterTicketTache = function (ht) {\n    var _this = this;\n    console.log(this.ticketTacheForm.value);\n    var ticketTache = this.ticketTacheForm.value;\n    ticketTache.ht = ht;\n    ticketTache.sprintBacklogId = null;\n    ticketTache.ticketHistoireId = ht.id;\n    console.log(ticketTache);\n    this.ticketTacheService.ajouterTicketTache(ticketTache).subscribe(function (data) {\n      console.log(data);\n      _this.ticketTacheList.push(data);\n      _this.ajouterTick = false;\n    });\n  };\n  //supprimer une ticket tache dans le panel de details sprint\n  SprintDialogPanelComponent.prototype.supprimerTicketTache = function (i) {\n    var _this = this;\n    if (confirm('vous êtes sur de supprimer cette tâche !')) this.ticketTacheService.supprimerTicketTache(this.ticketTacheList[i].id).subscribe(function (data) {\n      _this.ticketTacheList.splice(i, 1);\n    });\n  };\n  //lancer le sprint et generer un sprintBacklog avec force\n  SprintDialogPanelComponent.prototype.lancerSprintForcer = function () {\n    this.data.sprint.dateLancement = new Date(Date.now());\n    if (confirm(\"en appuyant sur le boutton <ok> votre sprint sera lancé avec la date \" + this.data.sprint.dateLancement)) {\n      this.lancerSprint();\n    }\n  };\n  //lancerNormalment le sprint dans la date de lancement\n  SprintDialogPanelComponent.prototype.lancerSprint = function () {\n    var _this = this;\n    this.data.sprint.etat = \"en cours\";\n    this.data.sprint.productBacklogId = this.data.sprint.productBacklog.id;\n    this.sprintService.modifierSprint(this.data.sprint).subscribe(function (dataSprint) {\n      console.log(dataSprint);\n      var sprintBacklog = new SprintBacklog();\n      sprintBacklog.velocite = dataSprint.velocite;\n      sprintBacklog.sprint = dataSprint;\n      sprintBacklog.sprintId = _this.data.sprint.id;\n      _this.data.TicketHistoires.forEach(function (ht) {\n        sprintBacklog.velocite += ht.effort;\n      });\n      console.log(\"spb  : \", sprintBacklog);\n      _this.sprintBacklogService.genererSprintBacklog(sprintBacklog).subscribe(function (dataSpBacklog) {\n        var nbrHeurTotal = 0;\n        for (var i = 0; i < _this.data.TicketHistoires.length; i++) {\n          _this.ticketTacheService.getListTicketTacheParHt(_this.data.TicketHistoires[i].id).subscribe(function (data) {\n            _this.ticketTacheList = data;\n            for (var j = 0; j < _this.ticketTacheList.length; j++) {\n              nbrHeurTotal += _this.ticketTacheList[j].nbHeurs;\n              _this.ticketTacheList[j].sprintBacklogId = dataSpBacklog.id;\n              _this.ticketTacheList[j].sprintBacklog = dataSpBacklog;\n              _this.ticketTacheService.modifierTicketTache(_this.ticketTacheList[j]).subscribe(function (ttData) {\n                console.log(ttData);\n              });\n            }\n          });\n        }\n        dataSpBacklog.nbrHeursTotal = nbrHeurTotal;\n        //modifier sprint backlog pour nbr heurs\n        console.log(dataSpBacklog);\n        _this.sprintBacklogService.modifierSprintBackog(dataSpBacklog).subscribe(function (dataSPB) {\n          return console.log(dataSPB);\n        });\n      });\n    });\n  };\n  //Supprimer le sprint\n  SprintDialogPanelComponent.prototype.supprimerSprint = function () {\n    var _this = this;\n    console.log(this.data.sprint.id);\n    if (this.data.TicketHistoires.length > 0) {\n      for (var i = 0; i < this.data.TicketHistoires.length; i++) {\n        this.detacherHt(this.data.TicketHistoires[i], i);\n      }\n    }\n    this.sprintService.supprimerSprint(this.data.sprint.id).subscribe(function (data) {\n      console.log(data);\n      _this.dialogRef.close();\n    });\n  };\n  __decorate([ViewChild('tacheDetails'), __metadata(\"design:type\", ElementRef)], SprintDialogPanelComponent.prototype, \"myDetails\", void 0);\n  __decorate([ViewChild('calendar'), __metadata(\"design:type\", ElementRef)], SprintDialogPanelComponent.prototype, \"calendarLancement\", void 0);\n  __decorate([ViewChild('calendarFin'), __metadata(\"design:type\", ElementRef)], SprintDialogPanelComponent.prototype, \"calendarFin\", void 0);\n  SprintDialogPanelComponent = __decorate([Component({\n    selector: 'app-sprint-dialog-panel',\n    templateUrl: './sprint-dialog-panel.component.html',\n    styleUrls: ['./sprint-dialog-panel.component.scss']\n  }), __param(1, Inject(MAT_DIALOG_DATA)), __metadata(\"design:paramtypes\", [MatDialogRef, Object, FormBuilder, SprintService, TicketTacheService, HistoireTicketService, SprintBacklogService])], SprintDialogPanelComponent);\n  return SprintDialogPanelComponent;\n}();\nexport { SprintDialogPanelComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}